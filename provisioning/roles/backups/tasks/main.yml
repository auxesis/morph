---
- name: Get Percona repository package
  get_url:
    url: "https://repo.percona.com/apt/percona-release_0.1-4.{{ ansible_distribution_release }}_all.deb"
    dest: /tmp/percona_release.deb
- name: Install Percona repository package
  apt: deb=/tmp/percona_release.deb
  register: apt
- name: Update apt caches
  apt: update_cache=yes
  when: apt.changed
- name: Install percona xtrabackup
  apt: pkg=percona-xtrabackup update_cache=yes cache_valid_time=3600
- name: Copy across database backup script
  copy: src=database-backup.sh dest=/usr/local/bin/database-backup.sh mode=0500
- name: Run database backup at 6:25am
  cron: name="database backup" hour=6 minute=25 user=root job="/usr/local/bin/database-backup.sh"
- name: Install duply
  apt: pkg=duply
- name: Add S3 support to duplicity
  apt: pkg=python-boto
- name: Install ntpd
  apt: pkg=ntp